---
name: Unit Tests

on:
  push:
  pull_request:

jobs:
  unit-tests:
    runs-on: ubuntu-24.04
    steps:
      - name: Checkout PG code
        uses: actions/checkout@v4

      - name: Install Ubuntu dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y --no-install-recommends --no-install-suggests \
            cpanminus \
            dvipng \
            dvisvgm \
            imagemagick \
            libclass-accessor-perl \
            libdbi-perl \
            libencode-perl \
            libgd-perl \
            libhtml-parser-perl \
            liblocale-maketext-lexicon-perl \
            libmojolicious-perl \
            libtest-mockobject-perl \
            libtest2-suite-perl \
            libtie-ixhash-perl \
            libuuid-tiny-perl \
            libyaml-libyaml-perl \
            pdf2svg \
            r-base-core \
            r-cran-rserve \
            texlive \
            texlive-latex-extra \
            texlive-latex-recommended \
            texlive-plain-generic

      - name: Install Perl dependencies
        run: cpanm --sudo -fi --notest HTML::TagParser

      - name: Run Perl unit tests
        run: |
          export PG_ROOT=`pwd`
          R_HOME=/usr/lib/R /usr/lib/R/site-library/Rserve/libs/Rserve --no-save
          prove -r t
